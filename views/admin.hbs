<div class="container admin-theme">
    <div class="admin-nav">
        <a href="/admin">← Chats</a>
        <form method="POST" action="/admin/logout" style="display: inline; float: right;">
            <button type="submit" class="btn logout-btn">Logout 🚪</button>
        </form>
    </div>
    
    <div class="header">
        <h1>Admin(Adithyan)</h1>
    </div>
    
    <div class="content">
        {{#if conversations}}
            <div class="conversation-list">
                {{#each conversations}}
                    <div class="conversation-card">
                        <div class="conversation-meta">
                            <span class="session-id">Anonymous User</span>
                            <span class="message-count">{{message_count}}</span>
                        </div>
                        <p><strong>Last seen:</strong> {{formatDate last_activity}}</p>
                        {{#if last_message_time}}
                            <p>{{formatDate last_message_time}}</p>
                        {{/if}}
                        <a href="/admin/conversation/{{id}}" class="btn">Open Chat</a>
                    </div>
                {{/each}}
            </div>
        {{else}}
            <div class="empty-state">
                <p>📭 No conversations yet. Share your anonymous message link to start receiving messages!</p>
            </div>
        {{/if}}
    </div>
</div>

<script>
// Auto-refresh admin dashboard every 5 seconds for new conversations
setInterval(function() {
    fetch(window.location.href)
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const newDoc = parser.parseFromString(html, 'text/html');
            const newConversationList = newDoc.querySelector('.conversation-list');
            const currentConversationList = document.querySelector('.conversation-list');
            
            if (newConversationList && currentConversationList) {
                // Only update if content changed
                if (newConversationList.innerHTML !== currentConversationList.innerHTML) {
                    currentConversationList.innerHTML = newConversationList.innerHTML;
                }
            } else if (newConversationList && !currentConversationList) {
                // First conversation received, reload page
                window.location.reload();
            }
        })
        .catch(error => console.log('Auto-refresh error:', error));
}, 5000);
</script>
