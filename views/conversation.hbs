<div class="container admin-theme">
    <div class="admin-nav">
        <a href="/admin">← Back</a>
    </div>
    
    <div class="header">
        <h1>Anonymous User</h1>
    </div>
    
    <div class="conversation-info">
        <p><strong>Started:</strong> {{formatDate conversation.created_at}}</p>
        <p><strong>Last seen:</strong> {{formatDate conversation.last_activity}}</p>
    </div>
    
    <div class="content">
        {{#if (lookup (query) 'success')}}
            <div class="alert alert-success">
                Message sent
            </div>
        {{/if}}
        
        {{#if (lookup (query) 'error')}}
            <div class="alert alert-error">
                {{#if (eq (lookup (query) 'error') 'empty')}}
                    Please enter a message
                {{else}}
                    Failed to send message
                {{/if}}
            </div>
        {{/if}}
        
        {{#if messages}}
            <div class="messages">
                {{#each messages}}
                    <div class="message {{#if is_admin_reply}}admin{{else}}user{{/if}}">
                        <p class="message-content">{{message}}</p>
                        <div class="message-time">{{formatDate created_at}}</div>
                    </div>
                {{/each}}
            </div>
        {{else}}
            <div class="empty-state">
                <p>No messages yet</p>
            </div>
        {{/if}}
        
        <div class="message-form">
            <form method="POST" action="/admin/reply/{{conversation.id}}" id="replyForm">
                <div class="form-group">
                    <div class="message-input-container">
                        <textarea name="reply" id="reply" placeholder="Type a message..." required rows="1"></textarea>
                        <button type="submit" class="btn">➤</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Auto-resize textarea
const replyTextarea = document.getElementById('reply');
if (replyTextarea) {
    replyTextarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 100) + 'px';
    });
}

// Auto-scroll to bottom
const messages = document.querySelector('.messages');
if (messages) {
    messages.scrollTop = messages.scrollHeight;
}
</script>